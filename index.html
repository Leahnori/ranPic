<html>
    <head>
        <link rel="stylesheet" type="text/css" href="ranPic.css" />
    </head>
    <body>
        <div id="wrapper" >
            <p>ranPic</p>
        </div>
        <div id="menu">
            <span><input id="b" type="button" value="stats" onClick="change('fig');"></span>
            <span><input id="b" type="button" value="input" onClick="change('in');"></span>  <!--both from textarea, file and tweet-->
            <span><input id="b" type="button" value="set" onClick="change('set');"></span> 
            <!--span><input id="b" type="button" value="output" onClick="change('out')"></span> <both file and pic download-->
        </div>

        <div id="rand" >
            <canvas id="canvas" width="256" height="256" onClick="mi();">random Canvas</canvas> <!--location.reload()-->
            <br>
            <a href="#" id="downloadra" download="ranPic.png">download</a>
        </div>

        <!--div id="ind" ></div--> <!--containing 1s and 0s-->

        <div id="fig"></div>

        <div id="in">
            <textarea id="text" placeholder="put here the code! :) you can use 0s or 1s to code it!" rows=8 ></textarea>
            <input id="b" type="button" value="visualize!" onClick="visualize();">

        </div>

        <div id="vica">
            <canvas id="vican" width="256" height="256" >visualized canvas</canvas>
            <br>
            <a href="#" id="downloadin" download="inPic.png">download</a>
        </div>


        <!--div id="out">
            <button id="create">create file</button> 
            <a download="info.txt" id="downloadlink" style="display: none">download</a>
        </div-->	

        <div id="set">
            <div id="part">mode</div>
            <form name="mode">
                <input type="radio" id="m1" name="color" checked><label>black and white</label>
                <br>
                <input type="radio" id="m2" name="color"><label>colorful</label>
            </form>
            <div id="part">size</div>
            <form name="size">
                <input type="radio" id="s0" name="color"><label>1x1</label>
                <br>
                <input type="radio" id="s1" name="color"><label>2x2</label>
                <br>
                <input type="radio" id="s2" name="color"><label>4x4</label>
                <br>
                <input type="radio" id="s3" name="color"checked><label>8x8</label>
                <br>
                <input type="radio" id="s4" name="color"><label for=>16x16</label>
                <br>
                <input type="radio" id="s5" name="color"><label for=>32x32</label>
                <br>
            </form>
            <div id="part" onClick="mi();">SET</div>
        </div>

        <div id="back">
            <span><input id="b" type="button" value="back" onClick="back();"></span>
        </div>

        <div id="twitter" style="text-align:center">
            <a class="twitter-share-button" href="https://twitter.com/share" data-via="ranPicpat"></a>
        </div>			
    </body>
</html>

<script type="text/javascript">

                function mi() {
                    window.onLoad = rand();
                }

                var color = 0;
                var zoom = 0;
                var prop = 0;

                var current = ""; //current site
                var code = ""; //for the textfile

                function setPixel(imageData, x, y, r, g, b, a) {
                    index = (x + y * imageData.width) * 4;
                    imageData.data[index + 0] = r;
                    imageData.data[index + 1] = g;
                    imageData.data[index + 2] = b;
                    imageData.data[index + 3] = a;
                }
                rand();

                function rand() {

                    var bigIndex = [];
                    //size
                    if (document.getElementById("s0").checked) {
                        zoom = 256;
                        prop = 1;
                    }
                    if (document.getElementById("s1").checked) {
                        zoom = 128;
                        prop = 2;
                    }
                    if (document.getElementById("s2").checked) {
                        zoom = 64;
                        prop = 4;
                    }
                    if (document.getElementById("s3").checked) {
                        zoom = 32;
                        prop = 8;
                    }
                    if (document.getElementById("s4").checked) {
                        zoom = 16;
                        prop = 16;
                    }
                    if (document.getElementById("s5").checked) {
                        zoom = 8;
                        prop = 32;
                    }

                    //color
                    var col = 0;
                    if (document.getElementById("m1").checked) {
                        col = 0;
                    }
                    if (document.getElementById("m2").checked) {
                        col = 1;
                    }

                    document.title = " ";
                    document.title += " Random images";
                    document.getElementById('fig').innerHTML = "";
                    //body color
                    var color = Math.floor(Math.random() * 16777215).toString(16);
                    while (color.length < 6) {
                        color = Math.floor(Math.random() * 16777215).toString(16);
                    }
                    document.body.style.background = '#' + color;
                    //pic
                    element = document.getElementById("canvas");
                    c = element.getContext("2d");

                    width = element.width;
                    height = element.height;

                    imageData = c.createImageData(width, height);
                    var m = 0;

                    if (col === 0) {
                        var r = 0;
                        var g = 0;
                        var b = 0;
                        var s = 0;
                        document.getElementById('fig').innerHTML = "";
                        for (var x = 0; x < width; x = x + zoom) {
                            var smIndex = [];
                            for (var y = 0; y < height; y = y + zoom) {
                                s = Math.floor(Math.random() * 2);
                                m = m + s;
                                var dot = 1;
                                if (s === 0) {
                                    r = 0;
                                    g = 0;
                                    b = 0;
                                } else {
                                    r = 255;
                                    g = 255;
                                    b = 255;
                                    dot = 0;
                                }
                                smIndex[smIndex.length] = dot;
                                for (var a = 0; a < zoom; a++) {
                                    for (var e = 0; e < zoom; e++) {
                                        setPixel(imageData, y + a, x + e, r, g, b, 255); // 255 opaque
                                    }
                                }
                            }
                            bigIndex[bigIndex.length] = smIndex;
                        }

                        /* for the txtfile
                         for (var q = 0; q < prop; q++) {
                         for (var r = 0; r < prop; r++) {
                         code += bigIndex[q][r];
                         }
                         }*/
                        if (prop <= 10) {
                            for (var q = 0; q < prop; q++) {
                                for (var r = 0; r < prop; r++) {
                                    document.title += bigIndex[q][r];
                                }
                            }
                        }

                        c.putImageData(imageData, 0, 0);

                        var horlinbla = 0;
                        var verlinbla = 0;
                        var horlinwhi = 0;
                        var verlinwhi = 0;
                        var blacross = 0;
                        var whitecross = 0;
                        var blacksquare = 0;
                        var whitesquare = 0;
                        var maxbla = 0;
                        var maxwhi = 0;

                        for (var q = 0; q < prop; q++) {
                            var w = 0;
                            for (var r = 0; r < prop; r++) {
                                if (bigIndex[q][r] === 1) {
                                    w++;
                                }
                            }
                            if (w === prop) {
                                horlinbla++;
                            }
                        }
                        for (var r = 0; r < prop; r++) {
                            var w = 0;
                            for (var q = 0; q < prop; q++) {
                                if (bigIndex[q][r] === 1) {
                                    w++;
                                }
                            }
                            if (w === prop) {
                                verlinbla++;
                            }
                        }
                        for (var q = 0; q < prop; q++) {
                            var w = 0;
                            for (var r = 0; r < prop; r++) {
                                if (bigIndex[q][r] === 0) {
                                    w++;
                                }
                            }
                            if (w === prop) {
                                horlinwhi++;
                            }
                        }
                        for (var r = 0; r < prop; r++) {
                            var w = 0;
                            for (var q = 0; q < prop; q++) {
                                if (bigIndex[q][r] === 0) {
                                    w++;
                                }
                            }
                            if (w === prop) {
                                verlinwhi++;
                            }
                        }

                        for (var i = 0; i <= prop - 3; i++) {
                            for (var j = 0; j <= prop - 3; j++) {
                                if (bigIndex[j][i] === 0 && bigIndex[j][i + 1] === 1 && bigIndex[j][i + 2] === 0 &&
                                        bigIndex[j + 1][i] === 1 && bigIndex[j + 1][i + 1] === 1 && bigIndex[j + 1][i + 2] === 1 &&
                                        bigIndex[j + 2][i] === 0 && bigIndex[j + 2][i + 1] === 1 && bigIndex[j + 2][i + 2] === 0) {
                                    blacross++;
                                }
                                if (bigIndex[j][i] === 1 && bigIndex[j][i + 1] === 0 && bigIndex[j][i + 2] === 1 &&
                                        bigIndex[j + 1][i] === 0 && bigIndex[j + 1][i + 1] === 0 && bigIndex[j + 1][i + 2] === 0 &&
                                        bigIndex[j + 2][i] === 1 && bigIndex[j + 2][i + 1] === 0 && bigIndex[j + 2][i + 2] === 1) {
                                    whitecross++;
                                }
                            }
                        }

                        for (var i = 0; i <= prop - 3; i++) {
                            for (var j = 0; j <= prop - 3; j++) {
                                if (bigIndex[j][i] === 1 && bigIndex[j][i + 1] === 1 && bigIndex[j][i + 2] === 1 &&
                                        bigIndex[j + 1][i] === 1 && bigIndex[j + 1][i + 1] === 1 && bigIndex[j + 1][i + 2] === 1 &&
                                        bigIndex[j + 2][i] === 1 && bigIndex[j + 2][i + 1] === 1 && bigIndex[j + 2][i + 2] === 1) {
                                    blacksquare++;
                                }
                                if (bigIndex[j][i] === 0 && bigIndex[j][i + 1] === 0 && bigIndex[j][i + 2] === 0 &&
                                        bigIndex[j + 1][i] === 0 && bigIndex[j + 1][i + 1] === 0 && bigIndex[j + 1][i + 2] === 0 &&
                                        bigIndex[j + 2][i] === 0 && bigIndex[j + 2][i + 1] === 0 && bigIndex[j + 2][i + 2] === 0) {
                                    whitesquare++;
                                }
                            }
                        }
                        for (var i = 0; i < prop; i++) {
                            for (var j = 0; j < prop; j++) {
                                if (i >= j) {
                                    for (var t = (prop - i - 1); t >= 0; t--) {
                                        var o = 0;
                                        var p = 0;
                                        for (var a = i; a <= (t + i); a++) {
                                            for (var b = j; b <= (j + t); b++) {
                                                if (bigIndex[a][b] === 1) {
                                                    o++;
                                                }
                                                if (bigIndex[a][b] === 0) {
                                                    p++;
                                                }
                                            }
                                        }
                                        var sq = Math.pow(t + 1, 2);
                                        if (o === sq && (t + 1) > maxbla) {
                                            maxbla = t + 1;
                                        }
                                        if (p === sq && (t + 1) > maxwhi) {
                                            maxwhi = t + 1;
                                        }

                                    }
                                } else if (i < j) {
                                    for (var t = prop - j - 1; t >= 0; t--) {
                                        var o = 0;
                                        var p = 0;
                                        for (var a = i; a <= (t + i); a++) {
                                            for (var b = j; b <= (j + t); b++) {
                                                if (bigIndex[a][b] === 1) {
                                                    o++;
                                                }
                                                if (bigIndex[a][b] === 0) {
                                                    p++;
                                                }
                                            }
                                        }
                                        var sq = Math.pow(t + 1, 2);
                                        if (o === sq && (t + 1) > maxbla) {
                                            maxbla = t + 1;
                                        }
                                        if (p === sq && (t + 1) > maxwhi) {
                                            maxwhi = t + 1;
                                        }
                                    }
                                }
                            }
                        }

                        document.getElementById('fig').innerHTML += (Math.pow(prop, 2) - m) + " number of black pieces <br>";
                        document.getElementById('fig').innerHTML += m + " number of white pieces <br>";
                        document.getElementById('fig').innerHTML += horlinbla + " number of horizontal full black lines <br>";
                        document.getElementById('fig').innerHTML += verlinbla + " number of vertical full black lines <br>";
                        document.getElementById('fig').innerHTML += horlinwhi + " number of horizontal full white lines <br>";
                        document.getElementById('fig').innerHTML += verlinwhi + " number of vertical full white lines <br>";
                        document.getElementById('fig').innerHTML += blacross + " number of black cross <br>";
                        document.getElementById('fig').innerHTML += whitecross + " number of white cross <br>";
                        document.getElementById('fig').innerHTML += blacksquare + " number of black 3x3 square <br>";
                        document.getElementById('fig').innerHTML += whitesquare + " number of white 3x3 square <br>";
                        document.getElementById('fig').innerHTML += maxbla + "x" + maxbla + " biggest black square size <br>";
                        document.getElementById('fig').innerHTML += maxwhi + "x" + maxwhi + " biggest white square size <br>";

                        for (var i = 0; i < prop; i++) {
                            for (var j = 0; j < prop; j++) {
                                document.getElementById("fig").innerHTML += bigIndex[i][j];
                            }
                            document.getElementById("fig").innerHTML += "<br>";
                        }
                    }

                    if (col === 1) {
                        document.title = "Random colored! :)";
                        var r = 0;
                        var g = 0;
                        var b = 0;
                        for (var x = 0; x < width; x = x + zoom) {
                            var smIndex = [];
                            for (var y = 0; y < height; y = y + zoom) {
                                r = Math.floor(Math.random() * 255);
                                g = Math.floor(Math.random() * 255);
                                b = Math.floor(Math.random() * 255);

                                for (var a = 0; a < zoom; a++) {
                                    for (var e = 0; e < zoom; e++) {
                                        setPixel(imageData, y + a, x + e, r, g, b, 255); // 255 opaque
                                    }
                                }

                            }
                            c.putImageData(imageData, 0, 0);
                        }
                    }
                }


                function setCharAt(str, index, chr) {
                    if (index > str.length - 1)
                        return str;
                    return str.substr(0, index) + chr + str.substr(index + 1);
                }
                function visualize() {

                    var r = 0;
                    var g = 0;
                    var b = 0;

                    var z = 0;
                    var p = 0;
                    if (document.getElementById("s0").checked) {
                        z = 256;
                        p = 1;
                    }
                    if (document.getElementById("s1").checked) {
                        z = 128;
                        p = 2;
                    }
                    if (document.getElementById("s2").checked) {
                        z = 64;
                        p = 4;
                    }
                    if (document.getElementById("s3").checked) {
                        z = 32;
                        p = 8;
                    }
                    if (document.getElementById("s4").checked) {
                        z = 16;
                        p = 16;
                    }
                    if (document.getElementById("s5").checked) {
                        z = 8;
                        p = 32;
                    }

                    var da = document.getElementById("text").value;
                    for (var o = 0; o < da.length; o++) {
                        var i = da.charAt(o).toString();
                        if (i !== "1" && i !== "0") {
                            da = setCharAt(da, o, "");
                            o--;
                        }
                    }
                    document.getElementById("text").value = da;

                    if (da.length < (Math.pow(p, 2))) {
                        for (var t = da.length; t < Math.pow(p, 2); t++) {
                            da = da + "0";
                        }
                    } else if (da.length > Math.pow(p, 2)) {
                        da = da.substr(0, Math.pow(p, 2));
                    }
                    element = document.getElementById("vican");
                    var c = element.getContext("2d");

                    width = element.width;
                    height = element.height;

                    var imageData = c.createImageData(width, height);

                    for (var x = 0; x < p; x++) {
                        for (var y = 0; y < p; y++) {
                            var s = da.charAt(x * p + y);
                            if (s === '1') {
                                r = 0;
                                g = 0;
                                b = 0;
                            } else {
                                r = 255;
                                g = 255;
                                b = 255;
                            }
                            for (var a = 0; a < z; a++) {
                                for (var e = 0; e < z; e++) {
                                    setPixel(imageData, y * z + a, x * z + e, r, g, b, 255); // 255 opaque
                                }
                            }
                        }
                    }

                    c.putImageData(imageData, 0, 0);
                    document.getElementById("vica").style.display = "block";
                    getImg();
                }
                function change(one) {
                    current = one;
                    document.getElementById(one).style.display = "block";
                    document.getElementById("back").style.display = "block";
                    document.getElementById("rand").style.display = "none";
                    document.getElementById("menu").style.display = "none";
                    document.getElementById("vica").style.display = "none";
                    document.getElementById("twitter").style.display = "none";
                }

                function back() {
                    document.getElementById("menu").style.display = "block";
                    document.getElementById("rand").style.display = "block";
                    document.getElementById(current).style.display = "none";
                    document.getElementById("vica").style.display = "none";
                    document.getElementById("back").style.display = "none";
                    document.getElementById("twitter").style.display = "block";

                }

                //twitter
                window.twttr = (function(d, s, id) {
                    var js, fjs = d.getElementsByTagName(s)[0], t = window.twttr || {};
                    if (d.getElementById(id))
                        return;
                    js = d.createElement(s);
                    js.id = id;
                    js.src = "https://platform.twitter.com/widgets.js";
                    fjs.parentNode.insertBefore(js, fjs);
                    t._e = [];
                    t.ready = function(f) {
                        t._e.push(f);
                    };
                    return t;
                }(document, "script", "twitter-wjs"));

                //downloadbutton
                var button = document.getElementById('downloadra');
                button.addEventListener('click', function(e) {
                    window.savephotoplugin(canvas, "image/png", device.version, function(val) {
                        alert("photo saved");
                    });

                    //var dataURL = canvas.toDataURL('image/png');
                    button.href = dataURL;
                });
                function getImg() {
                    //document.write("váá");
                    var button = document.getElementById('downloadin');
                    button.addEventListener('click', function(e) {
                        window.savephotoplugin(vican, "image/png", device.version, function(val) {
                            alert("photo saved");
                        });
                        //var dataURL = vican.toDataURL('image/png');
                        button.href = dataURL;
                    });
                }

                /* textfile making
                 var textFile = null;
                 function makeTextFile(text) {
                 var data = new Blob([text], {type: 'text/plain'});
                 
                 if (textFile !== null) {
                 window.URL.revokeObjectURL(textFile);
                 }
                 
                 textFile = window.URL.createObjectURL(data);
                 
                 return textFile;
                 }
                 
                 var create = document.getElementById('create');
                 var textbox = document.getElementById('textbox');
                 
                 create.addEventListener('click', function() {
                 var link = document.getElementById('downloadlink');
                 link.href = makeTextFile(code);
                 link.style.display = 'block';
                 }, false);*/

</script>

